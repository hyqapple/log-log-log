# script 标签的 defer 和 async

## defer

这个属性的用途是表明脚本在执行时不会影响页面的构造。也就是说，脚本会被延迟到整个页面都解析完毕后再运行。因此，在`<script>`元素中设置 `defer` 属性，相当于告诉浏览器立即下载，但延迟执行。

`HTML5` 规范要求脚本按照它们出现的先后顺序执行，因此第一个延迟脚本会先于第二个延迟脚本执行，而这两个脚本会先于 `DOMContentLoaded` 事件执行。在现实当中，延迟脚本并不一定会按照顺序执行，也不一定会在 `DOMContentLoad` 时间触发前执行，因此最好只包含一个延迟脚本。

我们可以认为是将外链的 js 放在了页面底部。js 的加载不会阻塞页面的渲染和资源的加载。不过 defer 会按照原本的 js 的顺序执行，所以如果前后有依赖关系的 js 可以放心使用。

## async

这个属性与 `defer` 类似，都用于改变处理脚本的行为。同样与 `defer` `类似，async` 只适用于外部脚本文件，并告诉浏览器立即下载文件。但与 `defer` 不同的是，标记为 `async` 的脚本并不保证按照它们的先后顺序执行。

第二个脚本文件可能会在第一个脚本文件之前执行。因此确保两者之间互不依赖非常重要。指定 async 属性的目的是不让页面等待两个脚本下载和执行，从而异步加载页面其他内容。

这个是 html5 中新增的属性，它的作用是能够异步的加载和执行脚本，不因为加载脚本而阻塞页面的加载。一旦加载到就会立刻执行在有 async 的情况下，js 一旦下载好了就会执行，所以很有可能不是按照原本的顺序来执行的。如果 js 前后有依赖性，用 async，就很有可能出错。

## 区别

概括来讲，就是这两个属性都会使 script 标签异步加载，然而执行的时机是不一样的

### 相同点

- 加载文件时不阻塞页面渲染
- 对于 inline 的 script（内联脚本）无效
- 使用这两个属性的脚本中不能调用 document.write 方法
- 有脚本的 onload 的事件回调

### 不同点

- html 的版本 html4.0 中定义了 defer；html5.0 中定义了 async
- 执行时刻每一个 async 属性的脚本都在它下载结束之后立刻执行，同时会在 window 的 load 事件之前执行。所以就有可能出现脚本执行顺序被打乱的情况；每一个 defer 属性的脚本都是在页面解析完毕之后，按照原本的顺序执行，同时会在 document 的 DOMContentLoaded 之前执行。

## 结论

- 如果 async 为 true，那么脚本在下载完成后异步执行。
- 如果 async 为 false，defer 为 true，那么脚本会在页面解析完毕之后执行。
- 如果 async 和 defer 都为 false，那么脚本会在页面解析中，停止页面解析，立刻下载并且执行。

## links

- [浅谈 script 标签的 defer 和 async](https://segmentfault.com/a/1190000006778717)
- [](https://juejin.im/post/5a1229596fb9a0451704cae8)
